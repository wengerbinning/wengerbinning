Linux的系统管理是Linux经常使用的管理命令,包括账户管理、文件管理、设备管理、进程管理、服务管理以及其他的系统管理。

## 账户管理

在Linux中每一个账户拥有用户名、用户口令、UID、GID、用户备注信息、用户目录以及用户默认shell等属性。这些信息都按照下列顺序以`:`为分隔符存储在`/etc/passwd`文件中。passwd文件的权限是644.账户有系统账户与普通账户之分。

* user name：是UID的别名。
* user password：是鉴别身份的依据，为提高安全性，将加密后的口令存储在`/etc/shadow`下，在该字段使用特殊字符替换。
* uid：是用户的唯一识别码，每个用户都有不同且唯一的uid，如果用户uid相同，则本质为同一用户，但是相同uid的多个用户可以有不同口令。管理员的UID为0,系统用户的UID为1~999,普通用户的UID从1000开始;
* gid：是用户组唯一识别码，系统用户组GID为0。
* user comment：用户的描述信息，没有强制格式，但是一般以`,`来分割，依次为用户全名、邮箱、电话等。
* home path：是存储用户文件的目录，一般在`/home/`下。
* login shell：是用户默认的登录shell。

在用户口令使用shadow之后，shadow每条记录具以下有格式，shadow的权限是640.

* User name：用户名。
* Encipherment password：使用sha512加密的口令。违用户的密码是`!!`或者`*`,新建的无密码的用户使用`!!`.
* Last modified time：是计算1970年01月01日到修改时间的天数。
* Minmum modification interval：是允许两次修改密码的最小间隔天数，在该时间内不允许修改密码。
* Validify of password：在该天数后强制要求用户变更密码。是距1970年1月1日之后的天数。
* The warning date before the password expires：密码过期前的警告天数。
* The grace period after the password has expired：密码过期后的宽限天数。
* Account expiration date：用户失效时间。是距1970年1月1日之后的天数。
* retain ： 保留字段。

用户组具有组名、gid、组成员、组密码、附加用户。`/etc/group`文件记录具有以下格式：group具有644的权限。

* group name： 用户组名。
* group password： 用户组密码，正真的密码也存放在shadow文件中。
* gid：是用户组的唯一识别码。make
* Additional user： 附加用户，记录改组内所有的附加用户。

在现今的Linux中采用sudo来让普通用户暂时拥有管理员权限。

* 【配置文件】sudo授权:`/etc/sudoers`;

### 用户管理

* 【功能】创建用户:使用`useradd`工具可以创建新的用户，根据不同参数可以创建特定的用户。

  ```shell
  # 显示useradd的默认参数。
  useradd -D
  # 创建默认参数的用户。
  useradd <user name>
  # 创建指定家目录所属路径的用户。
  useradd -b <home path> <user name>
  # 创建指定注释信息的用户。
  useradd -c <comment> <user name>
  # 创建指定家目录的用户。
  useradd -d <home path> <user name>

  useradd -p <password> <user name>    # 创建指定密码的用户
  useradd -r <username>               # 创建系统用户
  useradd -u <UID>  <username>        # 创建指定UID的用户
  useradd -g <group name> <user name>   # 创建指定用户组的用户
  ```

* 【功能】查看用户:使用`id、who`等命令以及用户配置文件可以查看当前用户以及所有用的信息。
makeer name>   # 查看指定用户信息
  id <user name>                       # 查看指定用户信息
  whoami                              # 查看当前登录用户信息
  compgen -u                          # 查看所有用户
  hostname                            # 显示主机名
  uname                               # 显示系统信息
  top                                 # 动态显示进程信息
  ps -aux                             # 显示当前时刻的进程信息
  su <username>                       # 切换用户
  sudo                                # 以管理员权限执行命令,配置文件在/etc/sudoers
  ```

* 【功能】修改用户：使用`usermod`可以修改用户的信息。在修改一些参数时，需要确认该用户无活动。

  ```shell
  # 修改指定用户的密码。
  passwd <user>
  # 修改用户的UID。
  usermod -u <UID>  <user>
  ```

* 【功能】删除用户:使用`userdel`可以删除用户。

  ```shell
  userdel <username>                  # 默认选项删除用户
  userdel -r <username>               # 删除用户以及家目录与 mail spool
  ```

* 【功能】用户通信:使用`write`可以在不同活动用户之间进行通信。

  ```shell
  echo "Hello" | write <username>     # 用另一个用户通信
  ```

### 群组管理

* 【功能】创建群组:创建群组。

  ```shell
  # 创建默认参数的用户组。
  groupadd <group>
  # 创建指定GID的用户组。


  ```shell
  groupmod -g <GID> <groupname>              # 修改用户组的GID
  gpasswd                                     # 管理用户组
  ```

* 【功能】查看群组：查询群组信息。

  ```shell
  cat /etc/group                    # 查看所有用户组信息
  cat /etc/group | grep <groupname> # 查看指定用户组信息
  groups                            # 查看当前用户所在组的信息
  compgen -g                        # 查看用户组信息
  ```

* 【功能】切换群组：切换当前用户的群组。

  ```shell
  newgrp <userGroupName>            # 切换用户组
  ```

* 【功能】删除群组:删除群组。

  ```shell
  groupdel <groupname>              # 删除用户组
  ```

* 【功能】修改群组：修改群组信息。

  ```shell
  gpasswd
  groupmod
  ```

## 文件管理

* 【功能】新建文件:

  ```shell
  # 新建一个空的文件。
  touch <file>
  # 通过重定向的方式创建文件。
  echo <content>  > <file>
  # 创建一个硬链接文件。
  ln <sources file> <object>
  # 创建一个软连接文件，创建软连接的可执行文件不能被执行。
  ln -s <source_file> <object>
  # 创建一个目录。
  mkdir <directory>
  ```

* 【功能】查看文件:

  ```shell
   # 查看文件内容。
  cat <file>
  # 从最后一行开始显示。
  tac <file>
  # 带行号显示文件。
  nl <file>
  # 格式化显示文本内容。
  printf <format string> <content>
  # 分页查看文件内容。
  more <file>
  # 分页查看文件内容，可以前翻。
  less <file>
  # 显示文件的头部，默认显示头部10行内容。
  head <file>
  # 显示文件的尾部。
  tail <file>
  # 以二进制的方式显示
  od  <file>
  # 统计文件字节数、行数、字数。
  wc -clw <file>
  export                  # 显示环境变量
  ls                      # 显示目录下的所有内容;
  stat                    # 详细显示文件或目录信息;
  pwd                     # 显示工作目录
  diff                    # 比较两个文件
  # 根据路径显示文件名。
  basename <path>
  # 根据文件名显示路径。
  dirname <file>
  size                    # 查看二进制文件的内存信息。
  ```

* 【功能】修改文件:

  ```shell
  chgrp <groupname> <filename>       # 修改文件所有者所在组
  chown <user name>:<group name> <file name>        # 修改文件所有者
  chmod <number> <filename>          # 修改文件属性
  # 使用字符串替换的方式批量修改文件名。
  rename <oldstring> <newstring> <file>
  # 转换文件编码格式。
  iconv <source file> -f <source type> -t <goal type> -o <goal type>
  # 将文件的制表符转换为空白字符。
  expand -t 4 <file>
  # 将文件的空白字符转换为制表符。
  unexpand -t 4 <file>
  # 将文本转化为适合打印的格式。
  pr -h <title> -l <line> <file>
  # 将文件内容以字符为单位反序输出。
  rev <file>
  ```

* 【功能】复制文件:

  ```shell
  cp <sourcefilename> <objectfilename>     # 复制文件
  cp -r <sourcefilename> <objectfilename>  # 复制目录
  ```

* 【功能】移动文件:

  ```shell
  mv <sourcefilename> <objectfilename>    # 移动或重命名
  cd <WorkingDirectory>                   # 切换工作目录
  ```

* 【功能】删除文件:

  ```shell
  rm <filename>                           # 移除文件或目录;
  rmdir <directoryname>                   # 删除空目录
  rm -r <directoryname>                   # 删除目录及其子目录;
  # 检查和删除重复内容
  uniq -cdu <file>
  # 删除文件，不能删除目录。
  unlink <file>
  ```

* 【功能】文件查询：

  ```shell
  find <filename>                    # 查找文件,不常使用,对硬盘有损伤
  find / -name "*.c"                 # 发现根目录下的所有c文件
  which <filename>                   # 查找文件,查找$PATH中的内容
  whereis <filename>                 # 查找文件,在数据库中寻找,使用updatedb更新数据库
  locate <filename>                  # 查找文件,同上
  grep <filename>
  ```

* 【功能】其他操作：

  ```shell
  # 创建或更新slocate数据库文件。
  updatedb
  ```

在远距离的文件传输中,经过压缩后再传输会节省很多资源,常用的解压软件有`compress`与`tar`;在Linux中`tar`是常用的压缩工具。

* 【功能】压缩文件:

  ```shell
  tar -cvf <*.tar> <filename>                 # 仅打包文件
  tar -czvf <*.tar.gz> <filename>             # 以gzip方式压缩并打包
  tar -cjvf <*.tar.bz2> <filename>            # 以bzip2方式压缩并打包
  ```

  > Note: -c参数为打包文件，-z参数是以gzip的方式压缩文件，-j参数是以bzip2的方式压缩文件，-v参数是显示过程，-f <package name>为指定包文件。

* 【功能】解压文件:

  ```shell
  tar -xvf <*.tar>  <path>                    # 解包
  tar -xzvf <*.tar.gz> <path>                 # 以gzip方式解压并解包
  tar -xjvf <*.tar.bz2> <path>                # 以bzip2方式解压
  ```

  > Note: -x为解压文件。
  
## 设备管理

设备管理即各种外部设备，例如硬盘、U盘等设备的管理。通过以下工具可以方便地管理设备：

* fdisk：主要用于磁盘分区。
* du：用于查看文件的存储空间信息。
* df：查看已挂载的磁盘信息。包括总空间大小、已使用、磁盘类型等。
* fsck：用于检查磁盘。
* blkid：用于显示磁盘的uuid。
* partprobe：@!应该是格式化磁盘。

以下为频繁使用的命名示例：

  ```shell
  #　显示磁盘uuid。
  blkid
  # 检查磁盘。
  fsck
  # 显示已挂载磁盘的信息。
  df -TH
  #　以Mb为单位显示当前目录下文件最大深度为2的存储大小信息。
  du -BM -d2 ./
  # 磁盘sda分区。
  fdisk /dev/sda
  # 分区完成后，重新载入磁盘分区信息。
  partprobe /dev/sda
  # 格式化分区：
  mkfs.ext4 /dev/sda1
  # 格式化完成后续优化配置，取消磁盘自检
  tune2fs -c -1 /dev/sda1
  ```

  > Note：开机时自动执行`etc/re.d/re.local`脚本文件。

当然以上命令都是基于磁盘设备已经被挂载之后的操作，在此之前我们可以使用`mount`来挂载设备或者修改配置文件`/etc/fstab`来设备开启时自动挂载。

  ```shell
  # 挂载外部设备。
  mount <option> <device_name>
  mount /dev/sda1 -o uid=65534,gid=65534,dmask=002,fmask=003 /mnt/share
  # 卸载外部设备。
  umount <option> <device_name>
  ```

  > Note：挂载配置文件`etc/fstab`。

* 【功能】格式化磁盘：
  
  ```shell
  mkfs
  # 格式化NTFS格式sda1分区。
  mkfs.ntfs -L <Label> /dev/sda1
  ```

* 【文件】自动挂载的配置文件`etc/fstab`：

  ```shell
  <设备名> <挂载点> <文件系统类型> <挂载选项>
  ```

## 任务管理

### 进程管理

* 【功能】查询进程信息：

  ```shell
  # 打印所有运行的进程。
  ps -a
  ps -aux
  ```

* 【功能】树状形式显示进程。

  ```shell
  # 以树状的形式显示所有进程。
  pstree
  ```

* 【功能】监控进程所使用的资源。

  ```shell
  top
  htop
  ```

* 【功能】设置和改变进程的优先级。

  ```shell
  nice
  renice
  ```

* 【功能】结束进程。

  ```shell
  kill
  killall
  pkill
  ```

* 【功能】控制系统资源在shell和进程上的分配量。

  ```shell
  ulimit -a
  ```

* 【功能】所有登陆用户的信息。

  ```shell
  w
  who
  whoami
  ```

* 【功能】进程全局正则匹配输出。

   ```shell
   pgrep
   ```

* 【功能】后台执行进程：

    ```shell
    # 将后台进程调到前台。
    fg %<>
    # 将前台进程调到后台。也可以通过Ctrl+Z实现。
    bg
    # 现实后台运行进程。
    jobs
    ```

* 【功能】报告进程见通信设施状态。

  ```shell
  ipcs -p -m
  ```

### 计划作业

* 【命令】`crontab`：定时执行任务。
  
  ```shell
  # 进入任务编辑模式。
  crontab
  # 进入默认编辑器任务编辑模式。
  crontab -e
  # 显示需要执行任务。
  crontab -l
  # 取消定时任务。
  crontab -r
  # 指定脚本定时计划。
  ```

  > Note：无论是进入任务编辑模式，还是脚本执行，格式都是`<minute> <hour> <day> <month> <week> <command>`。该命令是基于crond服务的。

* 【命令】`at`：定时执行任务。

  ```shell
  # 进入任务编辑模式。
  at <hour>:<minute>
  # 显示所有需要执行的任务。
  atq
  #显示定时任务详细内容。
  at -c <number>
  # 删除定时任务。
  atrm <number>
  ```

## 服务管理

在原来的`service`工具的基础上,开发了`systemctl`工具;chkconfig是centos发行版的服务配置工具，sysv-rc-conf是ubuntu的配置工具，service管理的服务脚本都是放在/etc/init.d下面。而systemctl的服务配置脚本是放在/usr/lib/systemd/system与/etc/systemd/system。

* 【功能】启动服务:

  ```shell
  systemctl start <serviceName>             # 启动服务
  systemctl enable <serviceName>            # 开机启动服务 
  ```

* 【功能】重启服务:

  ```shell
  systemctl restart <serviceName>
  ```

* 【功能】查询状态:

  ```shell
  systemctl status <serviceName>          # 查看服务状态
  systemctl is-enabled <serviceiceName>   # 查看服务是否开机启动
  systemctl list-unit-files | grep enabled # 查看已启动的服务
  systemctl --failed                      # 查看启动失败的服务
  ```

* 【功能】关闭服务:

  ```shell
  systemctl stop <serviceName>            # 关闭服务
  systemctl disable <serviceName>         # 开机禁用服务
  ```
	  
  * 配置文件：
	  
	  在systemctl中主要有四种类型的文件：*.mount、*.service、*.taget、*.wants四种，其中mount文件用于指定挂载路径，主要有mount部分。
	  
	  ```shell
	  [mount]
	  What=
	  Where=
	  Type=
	  ```
	  service文件定义服务，有Unit、Service、Install三个部分
	  
	  ```shell
	  [unit]
	  description=
	  after=
	  conditionpathexists=
	  
	  [service]
	  environmentfile=
	  execStart=
	  restart=
	  
	  [install]
	  Alias=
	  wangtedBy=
	  ```
	  
	  target定义了一些基础文件，供service调用。
	  
	  wants文件夹定义了要执行的文件集合，即该文件包含所有要执行的service。
	  

## 网络管理

* 【功能】命令的别名:

  ```shell
  alias   <name> = <command>
  unaliax <name>
  ```

* 【功能】网络的连通信:

  ```shell
  ping <IP>
  netsat
  ```

* 【功能】手动同步时间: `ntpdate -u cn.pool.ntp.org`,利用NTP服务;

* 【命令】`exec`：用于调用并执行指令的命令。

  ```shell
  exec <option> <partameter>
  ```

  > * `-c`：在空环境值执行指定的命令。

* 【命令】`lsof`：是一个集系统管理与系统安全的工具。
* 【命令】`tcpdump`：
* 【命令】`route`：路由表。
* 【命令】`arp`：

## 日志管理

在linux中，有一个logger用于日志管理，是属于util-linux软件包。